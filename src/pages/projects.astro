---
import Hero from '../components/hero.astro';
import Layout from '../layouts/layout.astro';
import type { Project } from '../types/projects';

function getFaviconUrl(href: string) {
  const hostname = new URL(href).hostname;
  // Simple, reliable favicon proxy
  return `https://www.google.com/s2/favicons?domain=${hostname}&sz=64`;
}

const projects: Project[] = [
  {
    title: "Budio",
    description: "A budget planner and expense tracker build for the web and comming soon for mobile.",
    tech: [
      'Next.js',
      'Convex',
      'Polar',
      'TypeScript',
    ],
    href: "https://budio.r1go.dev",
  },
  {
    title: "r1go.dev",
    description: "My personal website to showcase my projects and stuff I write about. Mostly done to experiment with SEO and other web search stuff.",
    tech: [
      'Astro',
      'TypeScript',
    ],
    href: "https://r1go.dev",
    github: "https://github.com/r1go/r1go.dev",
  }
];
---

<Layout>
  <section class="space-y-8">
		<Hero
      title="My projects"
      description="A selection of things Iâ€™ve built. Each one is designed to feel fast, polished, and useful."
    />

    <ul class="space-y-3">
      {projects.map((project, idx) => (
        <li class="reveal" style={`--delay: ${idx * 70}ms`}>
          <a
            href={project.href}
            target="_blank"
            rel="noopener noreferrer"
            class="group block rounded-2xl hover:shadow-md transition-all duration-450 bg-background/40 backdrop-blur-md px-4 py-2"
          >
            <div class="flex items-start justify-between gap-4">
              <div class="space-y-1">
                <div class="flex items-center gap-3">
                  <img
                    src={getFaviconUrl(project.href)}
                    alt={`${project.title} icon`}
                    width="20"
                    height="20"
                    loading="lazy"
                    decoding="async"
                    referrerpolicy="no-referrer"
                    class="h-5 w-5 rounded-sm"
                    onerror="this.style.display='none'"
                  />
                  <h2 class="text-base font-medium text-foreground leading-snug">
                    {project.title}
                  </h2>
                </div>
                <p class="text-sm text-muted-foreground leading-relaxed">
                  {project.description}
                </p>
                <div class="flex items-center gap-2">
                  {project.tech.map((tech) => (
                    <span class="text-xs text-muted-foreground bg-muted/40 rounded-full px-2 py-1">
                      {tech}
                    </span>
                  ))}
                </div>
              </div>
            </div>
          </a>
        </li>
      ))}
    </ul>
  </section>
</Layout>

<script is:inline>
  (function () {
    const reduceMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
    const items = document.querySelectorAll(".reveal");

    if (reduceMotion) {
      items.forEach((el) => el.classList.add("is-visible"));
      return;
    }

    const io = new IntersectionObserver(
      (entries) => {
        for (const entry of entries) {
          if (entry.isIntersecting) {
            entry.target.classList.add("is-visible");
            io.unobserve(entry.target);
          }
        }
      },
      { threshold: 0.15 }
    );

    items.forEach((el) => io.observe(el));
  })();
</script>

<style>
  .reveal {
    opacity: 0;
    transform: translateY(10px);
    transition:
      opacity 500ms ease,
      transform 500ms ease;
    transition-delay: var(--delay, 0ms);
    will-change: opacity, transform;
  }

  .reveal.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  @media (prefers-reduced-motion: reduce) {
    .reveal {
      opacity: 1;
      transform: none;
      transition: none;
    }
  }
</style>