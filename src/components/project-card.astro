---
import type { Project } from "../types/projects";
import { getFaviconUrl } from "../lib/utils";

type Props = {
  project: Project;
  variant?: "compact" | "full";
};

const { project, variant = "compact" } = Astro.props;
const isCompact = variant === "compact";
---

<a
  href={project.href}
  target="_blank"
  rel="noopener noreferrer"
  class:list={[
    "group flex items-start transition-colors",
    isCompact
      ? "rounded-lg p-2 -mx-2 hover:bg-muted/40 gap-2"
      : "rounded-2xl px-4 py-3 hover:bg-muted/40 gap-3",
  ]}
>
  <img
    src={getFaviconUrl(project.href)}
    alt={`${project.title} icon`}
    width="16"
    height="16"
    loading="lazy"
    decoding="async"
    referrerpolicy="no-referrer"
    class:list={[
      "rounded-sm opacity-80 group-hover:opacity-100 transition-opacity",
      isCompact ? "h-4 w-4 mt-0.5" : "h-5 w-5 mt-0.5",
    ]}
    onerror="this.style.display='none'"
  />
  <div class="flex-1 min-w-0">
    {
      isCompact ? (
        <>
          <div class="flex items-baseline gap-1.5 flex-wrap">
            <h3 class="text-sm font-medium text-foreground">
              {project.title}
            </h3>
            <div class="flex items-center gap-1">
              {project.tech.slice(0, 2).map((tech) => (
                <span class="text-[10px] text-muted-foreground/80">{tech}</span>
              ))}
            </div>
          </div>
          <p class="text-xs text-muted-foreground mt-0.5 leading-relaxed line-clamp-1">
            {project.description}
          </p>
        </>
      ) : (
        <>
          <h3 class="text-base font-medium text-foreground leading-snug">
            {project.title}
          </h3>
          <p class="text-sm text-muted-foreground leading-relaxed mt-1">
            {project.description}
          </p>
          <div class="flex items-center gap-2 mt-2">
            {project.tech.map((tech) => (
              <span class="text-xs text-muted-foreground bg-muted/40 rounded-full px-2 py-1">
                {tech}
              </span>
            ))}
          </div>
        </>
      )
    }
  </div>
  <svg
    class:list={[
      "text-muted-foreground opacity-0 group-hover:opacity-100 transition-opacity",
      isCompact ? "w-3 h-3 mt-0.5" : "w-4 h-4 mt-1",
    ]}
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
    ></path>
  </svg>
</a>
